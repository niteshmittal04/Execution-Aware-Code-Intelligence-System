services:
  - type: web
    name: execution-aware-backend
    runtime: python
    plan: free
    buildCommand: pip install -r backend/requirements.txt
    startCommand: uvicorn backend.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: MEGALLM_API_KEY
        sync: false
      - key: LLM_BASE_URL
        value: https://ai.megallm.io/v1
      - key: LLM_MODEL
        value: claude-sonnet-4-5-20250929|
      - key: LLM_API_KEY_ENV_VAR
        value: MEGALLM_API_KEY
      - key: GITHUB_CLONE_DIR
        value: ./data/repos
      - key: EXTERNAL_KNOWLEDGE_ENABLED
        value: "false"
    disks:
      - name: app-data
        mountPath: /opt/render/project/src/data
        sizeGB: 5

  - type: static_site
    name: execution-aware-frontend
    rootDir: frontend
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    envVars:
      - key: VITE_API_BASE_URL
        value: https://execution-aware-backend.onrender.com
    routes:
      - type: rewrite
        source: /*
        destination: /index.html